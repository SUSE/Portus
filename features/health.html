<!DOCTYPE html>
<html>
  <head>
    <title>Health checking</title>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="  Only available in 2.3 or later.">

    <link href="/stylesheets/portus.css"  type="text/css" rel="stylesheet" />
    <script src="/javascripts/dist/portus.min.js" type="text/javascript" charset="utf-8"></script>

    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!--[if lt IE 9]>
  <script src="//oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
  <script src="//oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->

<!-- Favicon for all different devices -->
<meta content="width=device-width, initial-scale=1" name="viewport" />
<link href="/images/favicon/apple-touch-icon-57x57.png" rel="apple-touch-icon" sizes="57x57" />
<link href="/images/favicon/apple-touch-icon-60x60.png" rel="apple-touch-icon" sizes="60x60" />
<link href="/images/favicon/apple-touch-icon-72x72.png" rel="apple-touch-icon" sizes="72x72" />
<link href="/images/favicon/apple-touch-icon-76x76.png" rel="apple-touch-icon" sizes="76x76" />
<link href="/images/favicon/apple-touch-icon-114x114.png" rel="apple-touch-icon" sizes="114x114" />
<link href="/images/favicon/apple-touch-icon-120x120.png" rel="apple-touch-icon" sizes="120x120" />
<link href="/images/favicon/apple-touch-icon-144x144.png" rel="apple-touch-icon" sizes="144x144" />
<link href="/images/favicon/apple-touch-icon-152x152.png" rel="apple-touch-icon" sizes="152x152" />
<link href="/images/favicon/apple-touch-icon-180x180.png" rel="apple-touch-icon" sizes="180x180" />
<link href="/images/favicon/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png" />
<link href="/images/favicon/android-chrome-192x192.png" rel="icon" sizes="192x192" type="image/png" />
<link href="/images/favicon/favicon-96x96.png" rel="icon" sizes="96x96" type="image/png" />
<link href="/images/favicon/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png" />
<link href="/images/favicon/manifest.json" rel="manifest" />
<link color="#205683" href="/images/favicon/safari-pinned-tab.svg" rel="mask-icon" />
<link href="/images/favicon/favicon.ico" rel="shortcut icon" />
<meta content="Portus" name="apple-mobile-web-app-title" />
<meta content="Portus" name="application-name" />
<meta content="#da532c" name="msapplication-TileColor" />
<meta content="/images/favicon/mstile-144x144.png" name="msapplication-TileImage" />
<meta content="/images/favicon/browserconfig.xml" name="msapplication-config" />
<meta content="#205683" name="theme-color" />

  </head>
  <body>
    <header id="portus-header" class="portus-topbar">
  <div class="container-fluid">
    <i id="open_main_menu" class="fa fa-bars fa-2x visible-xs menu-sandwich"></i>

    <a href="/">
      <img class="pull-left img-responsive topbar-logo" src="/images/logo-header.png" alt="Logo on header">
    </a>
    <div class="pull-right hidden-xs">
      <a class="btn btn-link" href="/blog/index.html">Blog</a>
      <a class="btn btn-link" href="/features.html">Features</a>
      <a class="btn btn-link" href="/documentation.html">Documentation</a>
    </div>
    <div class="clearfix"></div>
  </div>
</header>

<div id="mobile-menu" class="visible-xs mobile-menu">
  <ul>
    <li><i class="fa fa-list-ul"></i><a class="btn btn-link" href="/features.html">Features</a></li>
    <li><i class="fa fa-book"></i><a class="btn btn-link" href="/documentation.html">Documentation</a></li>
    <li><i class="fa fa-newspaper-o"></i><a class="btn btn-link" href="/blog/index.html">Blog</a></li>
    <li><i class="fa fa-question-circle"></i><a class="btn btn-link" href="/docs/FAQ.html">FAQ</a></li>
  </ul>
</div>

    <div class="container" id="documentation">
      <div class="row">
        <div class="post-content col-md-10 col-md-offset-3 col-sm-12 col-xs-12">
          <section>
            <div class="row">
              <div class="visible-xs visible-sm">
  <div class="content-bar">
    <ul class="topics">
      <li class="dropdown">
        <button class="dropdown-toggle" type="button" data-toggle="dropdown">Documentation Index
        <span class="caret"></span></button>
        <ul class="dropdown-menu">
          <li class="dropdown-header">Documentation</li>
          
          
            <li>
              <a href="/docs/first-steps.html">
                Docker and Portus for newcomers
              </a>
            </li>
          
            <li>
              <a href="/docs/Configuring-Portus.html">
                Configuring Portus
              </a>
            </li>
          
            <li>
              <a href="/docs/database.html">
                Configuring the database
              </a>
            </li>
          
            <li>
              <a href="/docs/How-to-setup-secure-registry.html">
                Configuring a secure private registry
              </a>
            </li>
          
            <li>
              <a href="/docs/deploy.html">
                Deploying Portus
              </a>
            </li>
          
            <li>
              <a href="/docs/Configuring-the-registry.html">
                Portus and your private registry
              </a>
            </li>
          
            <li>
              <a href="/docs/assets.html">
                Managing assets
              </a>
            </li>
          
            <li>
              <a href="/docs/secrets.html">
                Using secrets
              </a>
            </li>
          
            <li>
              <a href="/docs/API.html">
                Portus REST API
              </a>
            </li>
          
            <li>
              <a href="/docs/background.html">
                The background process
              </a>
            </li>
          
            <li>
              <a href="/docs/portusctl.html">
                portusctl
              </a>
            </li>
          
            <li>
              <a href="/docs/upgrading-portus.html">
                Upgrading Portus
              </a>
            </li>
          
            <li>
              <a href="/docs/versions.html">
                Supported Docker Versions
              </a>
            </li>
          
            <li>
              <a href="/docs/debugging.html">
                Debugging Portus
              </a>
            </li>
          
            <li>
              <a href="/docs/how_we_release.html">
                Portus Releases
              </a>
            </li>
          
            <li>
              <a href="/docs/migrate-from-rpm.html">
                Migrating from the RPM
              </a>
            </li>
          
            <li>
              <a href="/docs/release-schedule.html">
                Release schedule
              </a>
            </li>
          
            <li>
              <a href="/docs/FAQ.html">
                FAQ
              </a>
            </li>
          
          <li class="dropdown-header">Features</li>
          
          
            <li>
              <a href="/features/1_Synchronizing-the-Registry-and-Portus.html">
                Synchonizing the Registry and Portus
              </a>
            </li>
          
            <li>
              <a href="/features/2_LDAP-support.html">
                LDAP support
              </a>
            </li>
          
            <li>
              <a href="/features/3_teams_namespaces_and_users.html">
                Teams, namespaces and users
              </a>
            </li>
          
            <li>
              <a href="/features/4_audit.html">
                Audit
              </a>
            </li>
          
            <li>
              <a href="/features/5_search.html">
                Search
              </a>
            </li>
          
            <li>
              <a href="/features/6_security_scanning.html">
                Security scanning
              </a>
            </li>
          
            <li>
              <a href="/features/removing_images.html">
                Removing images and tags
              </a>
            </li>
          
            <li>
              <a href="/features/6_starring.html">
                Starring repositories
              </a>
            </li>
          
            <li>
              <a href="/features/7_disabling_users.html">
                Removing/Disabling users
              </a>
            </li>
          
            <li>
              <a href="/features/anonymous_browsing.html">
                Anonymous browsing
              </a>
            </li>
          
            <li>
              <a href="/features/8_locking.html">
                Locking accounts for safety reasons
              </a>
            </li>
          
            <li>
              <a href="/features/9_recovering_password.html">
                Recovering the password
              </a>
            </li>
          
            <li>
              <a href="/features/disabling_signup.html">
                Disabling the sign up form
              </a>
            </li>
          
            <li>
              <a href="/features/oauth.html">
                OAuth and OpenID Connect support
              </a>
            </li>
          
            <li>
              <a href="/features/application_tokens.html">
                Application tokens
              </a>
            </li>
          
            <li>
              <a href="/features/display_name.html">
                Display name
              </a>
            </li>
          
            <li>
              <a href="/features/health.html">
                Health checking
              </a>
            </li>
          
        </ul>
      </li>
    </ul>
  </div>
</div>

            </div>
            <div class="row post">
              <article>
                <div class="alert alert-info">
  Only available in <strong>2.3 or later</strong>.
</div>

<h2 id="ping">Ping</h2>

<p>Portus has the <code class="highlighter-rouge">/api/v1/_ping</code> endpoint exposed, so anyone can check whether it
is up and running. Portus will return an empty <code class="highlighter-rouge">200 OK</code> response. For example:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ curl -X GET -I https://registry.mssola.cat/api/v1/_ping
HTTP/1.1 200 OK
Server: nginx
Date: Fri, 04 Aug 2017 11:09:42 GMT
Content-Type: text/plain; charset=utf-8
Transfer-Encoding: chunked
Connection: keep-alive
X-Frame-Options: SAMEORIGIN
X-XSS-Protection: 1; mode=block
X-Content-Type-Options: nosniff
Cache-Control: no-cache
X-Request-Id: f23617bd-6732-433f-a9b6-1bc5717e345e
X-Runtime: 0.091130
X-Frame-Options: DENY
X-Content-Type-Options: nosniff
X-XSS-Protection: 1; mode=block
</code></pre></div></div>

<h2 id="health-check">Health check</h2>

<p>There is another endpoint which is a bit more complex than the ping one:
<code class="highlighter-rouge">/api/v1/health</code>. This will return a JSON body with the status of the different
components. For example:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ curl -X GET https://registry.mssola.cat/api/v1/health | jq
{
  "database": {
    "msg": "database is up-to-date",
    "success": true
  },
  "registry": {
    "msg": "registry is reachable",
    "success": true
  },
  "clair": {
    "msg": "clair is reachable",
    "success": true
  }
}
</code></pre></div></div>

<p>Some notes:</p>

<ul>
  <li><code class="highlighter-rouge">database</code> also reports when the DB is still initializing, among other
things.</li>
  <li><code class="highlighter-rouge">registry</code> not only check that the registry can be pingâ€™ed, but it also
performs checks: the idea is that the registry should not only be ready, but
also usable.</li>
  <li><code class="highlighter-rouge">clair</code> is shown in the above example because Portus was configured with
<a href="/features/6_security_scanning.html">clair support enabled</a>. If this is not
the case, then this check will be skipped.</li>
</ul>

<h3 id="clair-and-its-health-check">Clair and its health check</h3>

<p>Clair exposes the health check API on another port (see <a href="https://coreos.com/quay-enterprise/docs/latest/clair.html">its
documentation</a>). Because
of this, we provide the <code class="highlighter-rouge">health_port</code> value in the Portus configuration. This
has been set to the default value of Clair: 6061. If you want to change this,
just set the <code class="highlighter-rouge">PORTUS_SECURITY_CLAIR_HEALTH_PORT</code> environment variable, or
provide a <code class="highlighter-rouge">config-local.yml</code> file like so:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">security</span><span class="pi">:</span>
  <span class="na">clair</span><span class="pi">:</span>
    <span class="na">server</span><span class="pi">:</span> <span class="s2">"</span><span class="s">http://my.server"</span>
    <span class="na">health_port</span><span class="pi">:</span> <span class="s">6062</span>
</code></pre></div></div>

              </article>
            </div>
          </section>
        </div>
      </div>
      <aside class="hidden-xs hidden-sm content-list">
  <ul class="topics">
    <li>Documentation</li>
    <ul class="subtopics">
      
      
        
        <li>
          <a href="/docs/first-steps.html">
            Docker and Portus for newcomers
          </a>
        </li>
        
      
        
        <li>
          <a href="/docs/Configuring-Portus.html">
            Configuring Portus
          </a>
        </li>
        
      
        
        <li>
          <a href="/docs/database.html">
            Configuring the database
          </a>
        </li>
        
      
        
        <li>
          <a href="/docs/How-to-setup-secure-registry.html">
            Configuring a secure private registry
          </a>
        </li>
        
      
        
        <li>
          <a href="/docs/deploy.html">
            Deploying Portus
          </a>
        </li>
        
      
        
        <li>
          <a href="/docs/Configuring-the-registry.html">
            Portus and your private registry
          </a>
        </li>
        
      
        
        <li>
          <a href="/docs/assets.html">
            Managing assets
          </a>
        </li>
        
      
        
        <li>
          <a href="/docs/secrets.html">
            Using secrets
          </a>
        </li>
        
      
        
        <li>
          <a href="/docs/API.html">
            Portus REST API
          </a>
        </li>
        
      
        
        <li>
          <a href="/docs/background.html">
            The background process
          </a>
        </li>
        
      
        
        <li>
          <a href="/docs/portusctl.html">
            portusctl
          </a>
        </li>
        
      
        
        <li>
          <a href="/docs/upgrading-portus.html">
            Upgrading Portus
          </a>
        </li>
        
      
        
        <li>
          <a href="/docs/versions.html">
            Supported Docker Versions
          </a>
        </li>
        
      
        
        <li>
          <a href="/docs/debugging.html">
            Debugging Portus
          </a>
        </li>
        
      
        
        <li>
          <a href="/docs/how_we_release.html">
            Portus Releases
          </a>
        </li>
        
      
        
      
        
        <li>
          <a href="/docs/release-schedule.html">
            Release schedule
          </a>
        </li>
        
      
        
        <li>
          <a href="/docs/FAQ.html">
            FAQ
          </a>
        </li>
        
      
    </ul>
    <li>Features</li>
    <ul class="subtopics">
      
      
        <li>
          <a href="/features/1_Synchronizing-the-Registry-and-Portus.html">
            Synchonizing the Registry and Portus
          </a>
        </li>
      
        <li>
          <a href="/features/2_LDAP-support.html">
            LDAP support
          </a>
        </li>
      
        <li>
          <a href="/features/3_teams_namespaces_and_users.html">
            Teams, namespaces and users
          </a>
        </li>
      
        <li>
          <a href="/features/4_audit.html">
            Audit
          </a>
        </li>
      
        <li>
          <a href="/features/5_search.html">
            Search
          </a>
        </li>
      
        <li>
          <a href="/features/6_security_scanning.html">
            Security scanning
          </a>
        </li>
      
        <li>
          <a href="/features/removing_images.html">
            Removing images and tags
          </a>
        </li>
      
        <li>
          <a href="/features/6_starring.html">
            Starring repositories
          </a>
        </li>
      
        <li>
          <a href="/features/7_disabling_users.html">
            Removing/Disabling users
          </a>
        </li>
      
        <li>
          <a href="/features/anonymous_browsing.html">
            Anonymous browsing
          </a>
        </li>
      
        <li>
          <a href="/features/8_locking.html">
            Locking accounts for safety reasons
          </a>
        </li>
      
        <li>
          <a href="/features/9_recovering_password.html">
            Recovering the password
          </a>
        </li>
      
        <li>
          <a href="/features/disabling_signup.html">
            Disabling the sign up form
          </a>
        </li>
      
        <li>
          <a href="/features/oauth.html">
            OAuth and OpenID Connect support
          </a>
        </li>
      
        <li>
          <a href="/features/application_tokens.html">
            Application tokens
          </a>
        </li>
      
        <li>
          <a href="/features/display_name.html">
            Display name
          </a>
        </li>
      
        <li>
          <a href="/features/health.html">
            Health checking
          </a>
        </li>
      
    </ul>
  </ul>
  <div class="credits">
    <div class="text-center" lang="en">Created with <i class='fa fa-heart secondary-colour'></i> by the SUSE team</div>
  </div>
</aside>

      <div class="visible-xs visible-sm credits">
        <div class="text-center" lang="en">Created with <i class='fa fa-heart secondary-colour'></i> by the SUSE team</div>
      </div>
    </div>
  </body>
</html>
